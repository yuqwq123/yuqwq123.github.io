<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>如何选择适合的公共 DNS？ | 一只好运の鱼</title>
<link rel="shortcut icon" href="https://yuqwq123.github.io/favicon.ico?v=1644213816682">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://yuqwq123.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="如何选择适合的公共 DNS？ | 一只好运の鱼 - Atom Feed" href="https://yuqwq123.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="本文转自:https://blog.skk.moe/post/which-public-dns-to-use/

DNS 是互联网的基石之一，之前我在博客的 DNS 标签下写了不少关于权威 DNS 的文章，这次写一篇关于递归 DNS（也就是..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://yuqwq123.github.io">
  <img class="avatar" src="https://yuqwq123.github.io/images/avatar.png?v=1644213816682" alt="">
  </a>
  <h1 class="site-title">
    一只好运の鱼
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              如何选择适合的公共 DNS？
            </h2>
            <div class="post-info">
              <span>
                2022-02-07
              </span>
              <span>
                13 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>本文转自:https://blog.skk.moe/post/which-public-dns-to-use/<br>
<img src="https://yuqwq123.github.io/post-images/1644213719546.webp" alt="" loading="lazy"></p>
<p>DNS 是互联网的基石之一，之前我在博客的 DNS 标签下写了不少关于权威 DNS 的文章，这次写一篇关于递归 DNS（也就是公共 DNS）的文章，从公共 DNS 的必要性、利弊来讲一讲选择公共 DNS 需要关注的事情，以及列举一些当前主流的公共 DNS。</p>
<p>是否需要公共 DNS<br>
在选择公共 DNS 之前，你需要考虑一个问题：你是否真的需要公共 DNS 么？</p>
<p>无论我们是 PPPoE 拨号上网，还是 DHCP 连接光猫上网，互联网服务提供商（ISP）都会下发两个 DNS 给你。为了方便介绍，在下文中我称这两个 DNS 为 ISP DNS。<br>
在 DNS 的解析过程中，用户向递归 DNS 发起请求，递归 DNS 向权威 DNS 请求解析结果，可以说递归 DNS 起到一种转发的作用。运营商的 ISP DNS 就是递归 DNS；同时一些个人或互联网服务提供商也会架设自己的递归 DNS 开放给所有人使用，称为公共 DNS。</p>
<p>对于绝大部分人来说，运营商下发的 ISP DNS 应该是最准确的和最合适的，响应时间短、CDN 解析结果也会最准确。</p>
<p>但是运营商不是做公益的。运营商经常使用 DNS 投毒来引导用户去使用他们的 缓存服务器，从而降低运营商带宽负载；或者劫持解析将用户引导去他们已经插入了广告的镜像站点，从而获利；或者为了国家相关法律政策要求或者运营商自己的需求屏蔽一些网站的访问（如辽宁联通曾将工信部举报站点的域名解析至 127.0.0.1）；或者自行篡改 TTL（DNS 结果缓存时间）降低 DNS 的负载，结果就是解析结果不能尽快更新；或者对于不正确的域名给你返回一个满是广告的页面，等等。即使运营商非常良心不使用 DNS 做坏事，也有可能因为设备没有及时扩容或者维护不善而导致不佳的体验。</p>
<p>如果你为了追求更安全、更准确的 DNS 解析结果而决定继续使用公共 DNS（比如和我一样 雾），你就可以继续阅读下去了。</p>
<p>选择公共 DNS 时应该考虑什么<br>
公共 DNS 服务有很多，有大公司搭建的，有非盈利组织搭建的，还有个人搭建的，令人眼花缭乱。在选择的时候我们需要考虑很多方面才能选出适合我们需求的 DNS。通常在选择对于我们上网起非常重要作用的 DNS 时，我们需要考虑以下方面：</p>
<p>SLA 服务在线率。DNS 是上网冲浪事时非常重要的一个环节，DNS 的可靠性直接影响到上网的体验；如果 DNS 宕机，那么很大一部分网站将无法访问<br>
响应速度 在访问一个新的网站时，DNS 对这个网站的响应速度会直接影响到当前网站的直观加载速度<br>
准确性 即使不考虑 DNS 污染和投毒，DNS 对网站访问的结果是否准确是非常重要的<br>
EDNS 简单地说，EDNS（正确的简称应该是 ECS）有助于帮助你获取最准确的 CDN 解析结果<br>
其它特性 一些个人搭建的 DNS 会提供一些去广告或者爱国上网的功能<br>
DNS 出口 通常情况下，公共 DNS 的入口和出口不同。你可以通过 dig命令 查看你的 DNS 出口 IP：<br>
dig whoami.akamai.net<br>
DNS 出口对于 CDN 非常重要。公共 DNS 的本质上就是把你的查询请求转发给上游 DNS；在没有 EDNS 的情况下，CDN 的权威 DNS 会根据公共 DNS 使用的请求 IP（也就是 DNS 出口）来判定你的运营商、你所在的位置，从而返回距离你最近的节点 IP。<br>
所以说，理论上 ISP 给你分配的 DNS 应该是最快的、也是 CDN 友好的。本文接下来提到的 CDN 优化、CDN 友好，也是指的 DNS 出口的 IP 能否让你访问到最快的 CDN 节点。</p>
<p>受篇幅限制，本文只介绍一些大型的、有名的公共 DNS，而一些类似服务不稳定的 1.1.9.9（由牙木运营）公共 DNS 和速度慢 还不遵守 RFC 规范 的 IBM Quad9 DNS、Level 3 DNS，或者最好不被公开的 USTC 抗污染 DNS，亦或是只有单线单点部署的 360 公共 DNS、Verisign DNS，还有实际上没什么卵用的“安全 DNS” 如诺顿 DNS 和 OneDNS，本文就不介绍了。</p>
<p>中国国内一些公共 DNS 服务<br>
腾讯 DNSPod<br>
Anycast：上海、天津、广州、香港<br>
DNS 出口：同上<br>
ECS：不完整支持<br>
TCP 查询：不支持<br>
IPV4: 119.29.29.29, 119.28.28.28<br>
IPV6: 2402:4e00::<br>
DoH: https://doh.pub/dns-query<br>
DoT: dot.pub<br>
这是 DNSPod 建立的公共 DNS，之后 DNSPod 被腾讯收购以后由腾讯云负责运营。腾讯 DNSPod 公共 DNS 配置了 Anycast，节点囊括了腾讯云所有可用区的节点（包括海外），所以速度还是不错的，并且除了支持 ECS 以外还有一些关于 DNS 出口选择优化的加成，所以 CDN 解析结果相对准确很多。但是 SLA 却并不优秀—— 曾经 经常遭遇 DDoS 攻击导致无法解析。除此以外，由于相对出名、使用人数较多，是运营商重点劫持的对象。</p>
<p>值得一提的是，DNSPod 的公共 DNS 是免费提供 HTTPDNS 的，Demo 可以看 :https://www.dnspod.cn/httpdns/demo</p>
<p>阿里云公共 DNS<br>
Anycast：成都、深圳、杭州<br>
DNS 出口：同上<br>
ECS：部分支持（DNS JSON API 支持 edns_client_subnet）<br>
TCP 查询：不支持<br>
IPV4: 223.5.5.5 ,223.6.6.6<br>
IPV6: 2400:3200::1, 2400:3200:baba::1<br>
DoH: https://dns.alidns.com/dns-query<br>
DoT: dns.alidns.com<br>
阿里建立的公共 DNS。和腾讯一样，阿里公共 DNS 也是搭建在自家的云服务——阿里云上。虽然也配置了 Anycast，不过不包括海外节点，国内也就浙江阿里云和深圳阿里云两个节点， 而且华北地区都是隧道穿透回深圳，响应速度略逊于 DNSPod 提供的公共 DNS；阿里公共 DNS 不支持 ECS ，有 DNS 出口的优化 （一般都是广东出口），。关于阿里的公共 DNS 没有听说太多宕机、无法使用相关的报告。，但是倒是听说阿里公共 DNS 时常有返回 NXDOMAIN 影响使用体验。 NSDOMAIN 问题已得到一定缓解。</p>
<p>南京信风公共 DNS<br>
Anycast：南京、济南、芝加哥<br>
DNS 出口：未测出<br>
TCP 查询：不支持<br>
DoT、DoH：不支持<br>
ECS：不支持<br>
IPV4: 114.114.114.114, 114.114.115.115<br>
无疑是国内最著名的公共 DNS，但是显然不是最好的。有 Anycast，国内有南京和青岛济南两个节点、海外有芝加哥节点，响应速度不敢恭维。国内最著名的公共 DNS、使用的人很多，SLA 非常可靠，因此也是运营商重点劫持的对象。但是考虑到南京信风为运营商旁路广告劫持提供技术和硬件支持，对他们提供的公共 DNS 服务还是戴着有色眼镜来看吧。</p>
<p>CNNIC 公共 DNS<br>
Anycast：北京、杭州、香港<br>
DNS 出口：CNNIC 和阿里云<br>
TCP 查询：不支持<br>
DoT、DoH：不支持<br>
ECS：不支持<br>
IPV4: 1.2.4.8 ,210.2.4.8<br>
CNNIC 名声并不好（CNNIC Root CA 的故事），因此有些许人相对都有些对 CNNIC 的抵触心理。CNNIC 的公共 DNS（SDNS）国内仅双点部署、Anycast 配得一塌糊涂、速度堪忧，解析结果没有 CDN 优化（DNS 出口都是阿里云）。至于撇开 CNNIC 来谈 SDNS 推不推荐使用？SLA 比 DNSPod 的公共 DNS 还惨，解析请求时不时超时。</p>
<p>百度公共 DNS<br>
Anycast：北京、南京、深圳<br>
DNS 出口：同上<br>
DoT、DoH：不支持<br>
TCP 查询：不支持<br>
ECS：不支持<br>
IPV4：180.76.76.76<br>
IPV6: 2400:da00::6666<br>
百度的名声现在怕是比 CNNIC 还要臭得多，他们的公共 DNS 于 2017 年上线，现在也不被太多人知道，不过还是简单提两笔：百度也为公共 DNS 也配置了 Anycast，国内是北京、南京、深圳三点，海外是单点百度香港数据中心。用的人少，也许不容易被运营商劫持，有兴趣的可以试一试看。</p>
<p>国外常用 DNS 服务<br>
Google Public DNS<br>
Anycast：Google 的 36 个数据中心（不包括 Google Global Cache）<br>
DNS 出口：Google 全球边缘网络<br>
TCP 查询：支持<br>
DoH: https://dns.google/dns-query – RFC 8484 (GET and POST)<br>
https://dns.google/resolve? – JSON API (GET)<br>
DoT：dns.google<br>
ECS：支持（DNS JSON API 支持 edns_client_subnet）<br>
IPV4: 8.8.8.8 ,8.8.4.4<br>
IPV6: 2001:4860:4860::8888 ,2001:4860:4860::8844<br>
最著名的公共 DNS（即使在国内也是很有名的），得益于 Google 庞大的全球网络设施（不过 Google 公共 DNS 并未使用 Google Global Cache，并且在非洲和大洋洲也没有节点），速度虽然不能说是最快的，但是至少不慢；支持 ECS、DoH、DoT，SLA 无限接近 100（Google 搜索引擎的 SLA 是 99.9999%），海外 CDN 都有针对 Google DNS 做优化，解析海外站点时强烈推荐。</p>
<p>Cloudflare DNS<br>
Anycast：Cloudflare 的 160+ 个数据中心<br>
DNS 出口：Cloudflare 的 160+ 个数据中心<br>
TCP 查询：支持<br>
DoH：https://cloudflare-dns.com/dns-query<br>
DoT: cloudflare-dns.com<br>
ECS：不支持（由于 ECS 需要基于用户 IP 查询，和 Cloudflare DNS 保护隐私相违背）<br>
IPV4: 1.0.0.1 ,1.1.1.1<br>
IPV6: 2606:4700:4700::1111, 2606:4700:4700::1001<br>
当 Cloudflare 从 APNIC 手上接过 1.0.0.0/24 和 1.1.1.0/24 并架设了公共 DNS 以后，得益于 Cloudflare 全球 160+ 数据中心（Cloudflare 拥有 185+ 数据中心，但其公共 DNS 并没有部署在百度云加速的节点上）、BGP Anycast 和 Cloudflare Argo 等技术，成功超越 OpenDNS 成为了世界上最快的公共 DNS（数据来自 DNSPerf），还支持 DoT、DoH 等常见加密解析方案。由于其隐私政策，Cloudflare 公共 DNS 不记录用户 IP，意味着无法使用 ECS 等技术，不过仗着节点数量众多、DNS 出口覆盖全球各大区域，也适合作为主力 DNS。</p>
<p>OpenDNS<br>
Anycast：OpenDNS 的 32 个数据中心<br>
DNS 出口：未测出<br>
TCP 查询：支持<br>
DoT：不支持<br>
DoH: https://doh.opendns.com/dns-query<br>
ECS：支持<br>
IPV4: 208.67.222.222, 208.67.220.220<br>
IPV6: 2620:119:35::35 ,2620:119:53::53<br>
被 Cisco 收购的 OpenDNS 一度是世界上最快的公共 DNS——OpenDNS 在全球拥有 30 余节点并且 Anycast 配的很棒。支持 ECS 和 SLA 达到 100，而且 OpenDNS 开放非常规端口 5353 查询和 TCP 查询，即使从国内直接请求也不容易被污染和劫持。如果你在使用 ChinaDNS 这类工具同时又没有专门为其准备一条加密隧道，那么直连 OpenDNS 的 5353 就是一个不错的替代选择。</p>
<p>Freenom World<br>
Anycast：是<br>
DNS 出口：Freenom 的 Transit 的 IP<br>
TCP 查询：支持<br>
DoT、DoH：不支持<br>
ECS：支持<br>
IPV4: 80.80.80.80 ,80.80.81.81<br>
注册过后缀如 .cf .ga .ml .gq .tk的免费域名的，对 Freenom 这个名字一定不会陌生。这家荷兰域名注册商借助自己旗下的云服务资源也运营了一家公共 DNS 服务，卖点是隐私和安全。支持 ECS，测到的 DNS 出口都是落地 IP。部署了 Anycast 但是节点不多，响应速度并不算拔尖。Freenom 的公共 DNS 的一个特点其实是电信走 163 去 HK，联通移动走 IIJ 去 JP，因此如果你所在的地区和 ISP 对国外递归 DNS 的污染并不严重的话可以尝试使用 Freenom 的 DNS。</p>
<p>DNS.sb<br>
Anycast：是<br>
DNS 出口：SB Network 的上游的 IP<br>
TCP 查询：支持<br>
DoH：https://doh.sb/dns-query<br>
DoT: dot.sb<br>
ECS：不支持<br>
IPV4: 185.222.222.222 45.11.45.11<br>
IPV6: 2a09:: 2a11::<br>
和 Cloudflare 一样支持主流的 DoT、DoH 等加密 DNS 解析。启用了 Anycast，节点可能没有 Cloudflare 那么多，不过还是覆盖了大部分地区；此外，有 VPS 的可以试试 trace 一下 185.222.222.222、没准你会发现你的 VPS 和 dns.sb 在同一内网里。</p>
<p>公共 DNS 最佳实践<br>
综上所述，如果你需要选择公共 DNS 的话同时需要获得尽可能友好的 CDN 解析结果，解析国内站点推荐使用阿里 DNS 和腾讯 DNSPod（注重稳定请用前者、注重准确请用后者）；解析海外网站推荐主 DNS 1.1.1.1 或 208.67.222.222，备 DNS 8.8.8.8 或 8.8.4.4；有从国人商家购买 VPS 的可以 trace 一下 185.222.222.222 试试看。<br>
本文采用 CC BY-NC-SA 4.0 许可协议，著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。<br>
作者：Sukka<br>
来源：如何选择适合的公共 DNS？ [2020] | Sukka's Blog<br>
链接：https://blog.skk.moe/post/which-public-dns-to-use/</p>

              </div>
              <div class="toc-container">
                
              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://yuqwq123.github.io/post/hello-gridea/">
              <h3 class="post-title">
                Hello Gridea
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://yuqwq123.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
